<?php

/**
 * @file deploy_extra_tmode.module
 * TODO: Enter file description here.
 */

/**
 * Implements hook_menu().
 */
function deploy_extra_tmode_menu() {
  $items = array();
  return $items;
}

/**
 * Implements hook_deploy_entity_alter().
 */
function deploy_extra_tmode_deploy_entity_alter(&$entity, $entity_type) {
  if (empty($entity) || empty($entity_type)) {
    return;
  }

  list(,, $bundle_name) = entity_extract_ids($entity_type, $entity);
  $instances = field_info_instances($entity_type, $bundle_name);

}

/**
 * Implements hook_deploy_operation_info().
 */
function deploy_extra_tmode_deploy_operation_info() {
  return array(
    'preprocess' => array(
      array('callback' => 'deploy_extra_tmode_preprocess_operation'),
    ),
  );
}

/**
 * Preprocess operation callback.
 */
function deploy_extra_tmode_preprocess_operation($plan_name, $entity) {
  $plan = deploy_plan_load($plan_name);
  if (!empty($plan->aggregator_config['delete_post_deploy'])) {
    deploy_manager_delete_from_plan($plan->name, $entity->__metadata['type'], $entity);
  }
}

/**
 * Implements hook_form_alter().
 */
function hook_form_alter(&$form, &$form_state, $form_id) {
  if($form_id == 'deploy_plan') {
    $item = $form_state['item'];
  }

  if (isset($form['type']) && $form['type']['#value'] . '_node_settings' == $form_id) {
    $form['workflow']['upload_' . $form['type']['#value']] = array(
      '#type' => 'radios',
      '#title' => t('Attachments'),
      '#default_value' => variable_get('upload_' . $form['type']['#value'], 1),
      '#options' => array(t('Disabled'), t('Enabled')),
    );
  }
}

/**
 * Implements hook_services_resources_alter().
 */
function deploy_extra_tmode_services_resources_alter(&$resources, &$endpoint) {
  // TODO: Add some code here.
}

/**
 * Implements hook_schema_alter().
 */
function hook_schema_alter(&$schema) {
  // Add field to existing schema.
  $schema['users']['fields']['timezone_id'] = array(
    'type' => 'int',
    'not null' => TRUE,
    'default' => 0,
    'description' => 'Per-user timezone configuration.',
  );
}
